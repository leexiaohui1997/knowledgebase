# 拖放到根目录功能说明

## 🎯 新功能

现在可以将文件夹内的文件或文件夹直接拖放到根目录的空白区域了！

---

## 🖱️ 使用方法

### 方式 1：拖到空白区域（推荐）

**适用场景**：从任意深度的文件夹移出到根目录

**操作步骤**：
```
1. 展开包含文件的文件夹
2. 按住要移动的文件或文件夹
3. 拖动到文档树的空白区域（底部）
4. 看到背景变为浅绿色
5. 看到提示文字「拖到这里移至根目录」
6. 释放鼠标
```

**视觉反馈**：
- 整个文档树区域背景变为浅绿色（#e6f7ef）
- 底部显示绿色提示文字
- 鼠标显示为移动光标

### 方式 2：拖到根目录的其他节点（原有功能）

**适用场景**：需要精确控制在根目录中的位置

**操作步骤**：
```
1. 展开包含文件的文件夹
2. 拖动文件到根目录的某个节点上/下方
3. 看到绿色横线
4. 释放鼠标
```

---

## 📝 使用场景

### 场景 1：整理深层文件到根目录

**初始状态**：
```
📁 项目A
  📁 文档
    📁 归档
      📄 重要文件.md    ← 想移到根目录
```

**操作**：
1. 展开所有文件夹
2. 拖动「重要文件.md」到文档树底部空白区域
3. 释放

**结果**：
```
📁 项目A
  📁 文档
    📁 归档
📄 重要文件.md          ← 成功移到根目录
```

### 场景 2：提取文件夹到根目录

**初始状态**：
```
📁 旧项目
  📁 有用的资料        ← 想整个移到根目录
    📄 文档1
    📄 文档2
```

**操作**：
1. 展开「旧项目」
2. 拖动「有用的资料」文件夹到底部空白区域
3. 释放

**结果**：
```
📁 旧项目
📁 有用的资料          ← 成功移到根目录
  📄 文档1
  📄 文档2
```

### 场景 3：快速归档到根目录

**需求**：将多个文件从不同文件夹移到根目录

**操作**：
```
1. 拖动第一个文件到空白区域
2. 拖动第二个文件到空白区域
3. 拖动第三个文件到空白区域
...
```

**优势**：
- 不需要每次都找根目录的其他节点
- 操作更快速
- 目标区域更大，更容易拖到

---

## 🎨 视觉反馈详解

### 拖动过程

| 阶段 | 视觉效果 | 说明 |
|------|---------|------|
| 开始拖动 | 节点半透明 | 被拖动的节点变淡 |
| 进入空白区域 | 背景变浅绿色 | 整个文档树区域高亮 |
| 悬停时 | 提示文字显示 | 「拖到这里移至根目录」 |
| 离开区域 | 背景恢复 | 不再是有效拖放区域 |
| 释放鼠标 | 节点移动 | 移到根目录末尾 |

### 提示文字位置

```
┌─────────────────┐
│ 📁 文档目录      │
├─────────────────┤
│ 📁 文件夹1       │
│ 📄 文件1         │
│ 📄 文件2         │
│                  │
│  ⬇️ 拖放区域      │  ← 拖到这里
│                  │
│ 拖到这里移至根目录│  ← 提示文字（拖动时显示）
└─────────────────┘
```

---

## 💡 技巧和注意事项

### ✅ 推荐做法

1. **使用空白区域拖放**
   - 更快速：不需要精确对准
   - 更容易：目标区域大
   - 更直观：背景变色提示清晰

2. **批量移动时**
   - 逐个拖到空白区域
   - 最后在根目录调整顺序

3. **深层嵌套时**
   - 直接拖到空白区域
   - 比逐层移出更快

### ⚠️ 注意事项

1. **位置固定**
   - 拖到空白区域会放在根目录**末尾**
   - 如需精确位置，拖到具体节点上/下方

2. **需要展开文件夹**
   - 必须先展开才能看到要移动的文件
   - 折叠的文件夹内容无法拖动

3. **不影响子节点**
   - 移动文件夹时，子节点跟随移动
   - 结构保持不变

---

## 🆚 两种方式对比

### 拖到空白区域 vs 拖到节点

| 特性 | 拖到空白区域 | 拖到节点 |
|------|-------------|----------|
| 操作难度 | ⭐ 简单 | ⭐⭐ 中等 |
| 目标大小 | ⭐⭐⭐ 大 | ⭐ 小 |
| 位置精度 | 末尾 | 精确位置 |
| 速度 | ⭐⭐⭐ 快 | ⭐⭐ 中 |
| 适用场景 | 快速移出 | 精确排序 |

**建议**：
- 只需移到根目录 → 用空白区域
- 需要特定位置 → 用节点上/下方

---

## 🧪 快速测试

### 测试步骤（30秒）

1. **准备数据**
   ```
   创建结构：
   📁 测试文件夹
     📄 测试文件
   ```

2. **执行拖放**
   - 展开「测试文件夹」
   - 拖动「测试文件」到文档树底部
   - 看到背景变绿
   - 看到提示文字
   - 释放鼠标

3. **验证结果**
   ```
   预期结果：
   📁 测试文件夹
   📄 测试文件         ← 在根目录末尾
   ```

4. **刷新验证**
   - 刷新页面
   - 位置保持不变 ✓

---

## 🐛 问题排查

### 问题 1：拖到空白区域没反应

**可能原因**：
- 拖到了其他节点上
- 拖到了侧边栏外面

**解决方法**：
- 确保拖到文档树区域内
- 避开所有节点
- 拖到底部空白处

### 问题 2：背景没有变绿

**可能原因**：
- 鼠标离开了文档树区域
- 拖到了其他元素上

**解决方法**：
- 保持鼠标在文档树内
- 拖到节点之间的空隙

### 问题 3：提示文字不显示

**说明**：
- 提示文字只在拖动时显示
- 需要先开始拖动
- 进入文档树区域才会显示

---

## 📊 技术实现

### 事件处理

```javascript
// 拖到根目录空白区域
1. @dragover   → 背景变绿，显示提示
2. @dragleave  → 恢复正常
3. @drop       → 执行移动到根目录末尾
```

### 位置计算

```javascript
// 自动放在根目录末尾
const rootNodes = documents.filter(d => d.parentId === null)
const maxOrder = Math.max(...rootNodes.map(d => d.order))
newOrder = maxOrder + 1
```

---

## 🎯 最佳实践

### 推荐工作流程

1. **整理前**
   - 先规划好目标结构
   - 确定哪些放根目录
   - 哪些放文件夹内

2. **整理时**
   - 大文件夹直接拖到空白区域
   - 单个文件批量拖到空白区域
   - 最后在根目录调整顺序

3. **整理后**
   - 检查根目录结构
   - 必要时用右键菜单重命名
   - 用拖拽调整最终顺序

---

**现在可以更轻松地管理文档层级了！** 🎉✨

