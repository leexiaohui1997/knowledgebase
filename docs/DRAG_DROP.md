# 拖拽功能说明

## 🎯 功能概述

文档树现在支持完整的拖拽功能，可以通过拖拽来移动文件和文件夹，以及调整它们的顺序。

---

## 🖱️ 使用方法

### 基础拖拽操作

1. **按住并拖动**：在文件或文件夹上按住鼠标左键并拖动
2. **放置位置**：根据鼠标位置显示不同的放置提示
3. **释放鼠标**：在目标位置释放鼠标完成操作

---

## 📍 放置位置说明

### 1️⃣ 拖到文件夹上

根据鼠标在文件夹节点上的垂直位置，有三种放置方式：

#### **上部区域（0-25%）**
- **效果**：放在文件夹**前面**
- **视觉**：文件夹上方显示**绿色横线**
- **结果**：成为该文件夹的同级节点，排在它前面

#### **中部区域（25-75%）**
- **效果**：放**进**文件夹内
- **视觉**：文件夹背景变为**浅绿色**，显示**虚线边框**
- **结果**：成为该文件夹的子节点，排在最后

#### **下部区域（75-100%）**
- **效果**：放在文件夹**后面**
- **视觉**：文件夹下方显示**绿色横线**
- **结果**：成为该文件夹的同级节点，排在它后面

### 2️⃣ 拖到文件上

文件只有两种放置方式：

#### **上半部（0-50%）**
- **效果**：放在文件**前面**
- **视觉**：文件上方显示**绿色横线**
- **结果**：成为同级节点，排在该文件前面

#### **下半部（50-100%）**
- **效果**：放在文件**后面**
- **视觉**：文件下方显示**绿色横线**
- **结果**：成为同级节点，排在该文件后面

---

## 🎨 视觉反馈

### 拖拽过程中的视觉效果

| 状态 | 视觉效果 | 说明 |
|------|---------|------|
| 正在拖动 | 节点半透明（40%）| 被拖动的节点变淡 |
| 悬停目标 | 背景变为浅绿色 | 鼠标悬停的节点高亮 |
| 放在前面 | 上方绿色横线 | 将放在目标前面 |
| 放在后面 | 下方绿色横线 | 将放在目标后面 |
| 放入文件夹 | 浅绿背景+虚线边框 | 将成为文件夹的子项 |
| 鼠标样式 | `grab` → `grabbing` | 抓取手势 |

---

## 📝 使用场景

### 场景 1：调整文档顺序

**操作**：在同一层级内排序
```
拖动「文件A」到「文件B」上方
→ 文件A 会排在 文件B 前面
```

**示例**：
```
之前：
  📄 3-设计文档
  📄 1-需求文档
  📄 2-开发文档

操作：拖动「1-需求文档」到最上面

之后：
  📄 1-需求文档
  📄 3-设计文档
  📄 2-开发文档
```

### 场景 2：移动到文件夹内

**操作**：拖动到文件夹中部区域
```
拖动「文件A」到「文件夹B」的中部
→ 文件A 成为文件夹B的子项
```

**示例**：
```
之前：
  📁 前端
  📁 后端
  📄 API文档

操作：拖动「API文档」到「后端」文件夹中部

之后：
  📁 前端
  📁 后端
    📄 API文档
```

### 场景 3：移出文件夹

**操作**：拖动到父级节点
```
拖动文件夹内的文件到其他位置
→ 文件移出当前文件夹
```

**示例**：
```
之前：
  📁 项目A
    📄 需求文档
    📄 设计文档
  📁 项目B

操作：拖动「设计文档」到「项目B」下方

之后：
  📁 项目A
    📄 需求文档
  📁 项目B
  📄 设计文档
```

### 场景 4：整理文档结构

**操作**：批量移动和重组
```
1. 创建新文件夹「归档」
2. 拖动旧文件到「归档」中部
3. 拖动「归档」到底部
→ 完成归档整理
```

---

## 🛡️ 安全保护

### 防止无效操作

1. **禁止自己拖到自己**
   - 无法将节点拖到自身上
   - 尝试时无反应

2. **禁止父节点拖到子节点**
   - 无法将文件夹拖到自己的子孙节点中
   - 防止循环引用

3. **自动展开文件夹**
   - 当前版本需要手动展开文件夹
   - 未来可能支持悬停自动展开

---

## 💡 使用技巧

### 提高效率的方法

1. **精确放置**
   - 移动鼠标到精确位置
   - 观察视觉反馈（横线或背景色）
   - 确认后释放鼠标

2. **快速整理**
   - 先创建文件夹结构
   - 批量拖动文件归类
   - 最后调整顺序

3. **逐步调整**
   - 不确定时可以分多次移动
   - 每次移动会立即保存
   - 可以随时撤销（手动）

4. **配合右键菜单**
   - 拖拽：用于移动和排序
   - 右键：用于重命名和删除
   - 两者结合使用效率最高

---

## ⚙️ 技术实现

### 数据结构

每个文档节点包含 `order` 字段用于排序：

```typescript
interface DocumentNode {
  id: string
  name: string
  type: 'file' | 'folder'
  parentId: string | null
  order: number        // ← 排序字段
  // ... 其他字段
}
```

### 排序逻辑

1. **同级节点按 order 值排序**
   - order 值越小，位置越靠前
   - 移动节点时自动重新计算 order

2. **移动后自动重排**
   - 旧位置的兄弟节点重新编号
   - 新位置的兄弟节点重新编号
   - 确保 order 值连续（1, 2, 3...）

3. **持久化存储**
   - 每次移动立即保存到本地
   - 使用 Electron IPC 通信
   - 数据存储在 data.json 文件

### 拖拽事件流程

```
dragstart    → 记录被拖动的节点
  ↓
dragover     → 计算放置位置，显示视觉反馈
  ↓
dragleave    → 清除视觉反馈（离开时）
  ↓
drop         → 执行移动操作，更新数据
  ↓
dragend      → 清除所有状态
```

---

## 🎯 最佳实践

### 文档组织建议

1. **按主题分组**
   ```
   📁 需求分析
     📄 用户需求
     📄 功能需求
   📁 技术方案
     📄 架构设计
     📄 接口设计
   ```

2. **按时间排序**
   ```
   📄 2024-01-01 会议纪要
   📄 2024-01-05 进度报告
   📄 2024-01-10 阶段总结
   ```

3. **按重要性排序**
   ```
   📄 ⭐ 重要通知
   📄 每日任务
   📄 参考资料
   ```

### 维护建议

- **定期整理**：每周整理一次文档结构
- **保持扁平**：尽量不超过 3-4 层嵌套
- **命名规范**：使用清晰的文件名
- **及时归档**：将过期内容移到归档文件夹

---

## 🐛 注意事项

### 当前限制

1. **不支持多选拖动**
   - 一次只能拖动一个节点
   - 未来版本可能支持

2. **不支持跨知识库移动**
   - 只能在同一知识库内移动
   - 不同知识库间需要复制粘贴

3. **不支持撤销操作**
   - 移动后立即保存
   - 需要手动移回原位置

4. **文件夹需手动展开**
   - 拖动到折叠的文件夹不会自动展开
   - 需要先手动展开目标文件夹

### 性能说明

- **节点数量**：建议单个文件夹不超过 100 个子节点
- **嵌套层级**：建议不超过 10 层
- **移动速度**：每次移动需要几毫秒到几十毫秒
- **响应速度**：拖拽过程实时响应，流畅度高

---

## 🔮 未来计划

### 计划中的功能

- [ ] 多选拖动
- [ ] 悬停自动展开文件夹
- [ ] 拖动预览（拖动时显示半透明副本）
- [ ] 撤销/重做操作
- [ ] 拖拽范围限制（禁止区域）
- [ ] 批量排序工具
- [ ] 拖拽历史记录
- [ ] 自定义拖拽动画

---

## 📖 相关文档

- [右键菜单功能](./CONTEXT_MENU.md) - 配合拖拽使用
- [快速开始](./QUICK_START.md) - 基础操作指南
- [功能详解](./FEATURES.md) - 完整功能说明

---

**开始拖拽，享受高效的文档管理体验！** 🎉✨

